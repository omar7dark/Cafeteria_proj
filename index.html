<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒØ§ÙÙŠØªÙŠØ±ÙŠØ§</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Tahoma', sans-serif; background-image: url('ss.jpg'); padding: 20px; margin: 0; text-align: center; }
    h1, h2 { color: #333; margin-bottom: 20px; font-size: 46px; font-weight: bold; }
    .number { font-size: 46px; }
    .item-card { background: white; border-radius: 10px; padding: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); width: 100%; text-align: center; margin-bottom: 20px; }
    .item-card img { width: 100%; height: 250px; object-fit: cover; border-radius: 6px; }
    .item-card label { display: block; margin: 10px 0 5px; font-weight: bold; font-size: 46px; }
    .price { color: #666; margin-bottom: 5px; font-size: 46px; }
    .item-card input[type="number"] { width: 180px; padding: 5px; font-size: 46px; text-align: center; margin-bottom: 10px; }
    .item-card textarea { width: 100%; padding: 5px; font-size: 44px; resize: vertical; height: 99px; border-radius: 6px; }
    button { margin-top: 20px; background-color: #4CAF50; color: white; padding: 20px 50px; font-size: 46px; border: none; cursor: pointer; border-radius: 10px; }
    button:hover { background-color: #45a049; }
    .hidden { display: none; }
    #loading-spinner { display: none; margin-top: 20px; }
    .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
    .modal-content { background-color: white; margin: 10% auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 500px; text-align: right; font-size: xx-large; }
    .spinner { border: 6px solid #f3f3f3; border-top: 6px solid #4CAF50; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <h1>Ø·Ù„Ø¨Ø§Øª ÙƒØ§ÙÙŠØªÙŠØ±ÙŠØ§ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø­ÙˆÙƒÙ…Ø© Ø§Ù„Ø£Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙÙŠ Ù†ÙŠÙ†ÙˆÙ‰</h1>
  <h2 id="room-name">ØªØ­Ù…ÙŠÙ„...</h2>

  <div class="container">
    <div class="row" id="items-container"></div>
  </div>

  <button id="submit-btn" onclick="confirmOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</button>
  <div id="loading-spinner"><div class="spinner"></div></div>

  <div id="order-modal" class="modal">
    <div class="modal-content">
      <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</h3>
      <div id="order-summary" style="margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px;"></div>
      <div style="display: flex; gap: 10px;">
        <button onclick="submitConfirmedOrder()" style="flex: 1; background-color: #4CAF50;">ØªØ£ÙƒÙŠØ¯</button>
        <button onclick="closeModal()" style="flex: 1; background-color: #f44336;">ØªØ¹Ø¯ÙŠÙ„</button>
      </div>
    </div>
  </div>

  <script>
    const validRooms = ["Ø§Ù„Ù†Ø§Ø¯ÙŠ_Ø§Ù„Ø¹Ù„Ù…ÙŠ", "Ø§ØªØ­Ø§Ø¯Ø§Ù„Ø§ÙƒØ§Ø¯ÙŠÙ…ÙŠÙŠÙ†", "Ù†Ù‚Ø§Ø¨Ø©_Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ÙŠÙ†", "Ø§ØªØ­Ø§Ø¯Ø±Ø¬Ø§Ù„_Ø§Ù„Ø§Ø¹Ù…Ø§Ù„", "Ù…Ø±ÙƒØ²_Ù…Ø³ØªÙ‚Ø¨Ù„_Ù†ÙŠÙ†ÙˆÙ‰","Ø§Ù„Ù…Ø¹Ù‡Ø¯Ø§Ù„ÙØ±Ù†Ø³ÙŠ","ÙØ¬Ø±Ø§Ù„Ø­Ø¯Ø¨Ø§Ø¡"];
    const items = [
      { id: 'tea', name: 'Ø´Ø§ÙŠ', price: 250, img: 'tea.jpg' },
     // { id: 'lemon', name: 'Ø­Ø§Ù…Ø¶', price: 250, img: 'lemon.jpg' },
      { id: 'arabic_coffee', name: 'Ù‚Ù‡ÙˆØ© Ø¹Ø±Ø¨ÙŠØ©', price: 500, img: 'arabic_coffee.jpg' },
    //  { id: 'turkish_coffee', name: 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠØ©', price: 1000, img: 'turkish_coffee.jpg' },
      //{ id: 'chocolate_coffee', name: 'Ù‚Ù‡ÙˆØ© Ø¬ÙƒÙ„ÙŠØªÙŠØ©', price: 1000, img: 'choco_coffee.jpg' },
     // { id: 'milk_walnut', name: 'Ø­Ù„ÙŠØ¨ Ø³Ø§Ø®Ù†', price: 1000, img: 'milk_walnut.jpg' },
    //  { id: 'cappuccino', name: 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ', price: 1000, img: 'cappuccino.jpg' },
     { id: 'nescafe', name: 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡', price: 500, img: 'nescafe.jpg' },
     // { id: 'hot_nutella', name: 'Ù‡ÙˆØª Ù†ÙˆØªÙŠÙ„Ø§', price: 1000, img: 'hot_nutella.jpg' },
     // { id: 'choco_milk_walnut', name: 'ÙƒØ§ÙƒØ§Ùˆ ÙˆØ­Ù„ÙŠØ¨', price: 1000, img: 'choco_milk.jpg' },
     // { id: 'hot_chocolate', name: 'Ù‡ÙˆØª Ø¬ÙˆÙƒÙ„ÙŠØª', price: 1000, img: 'hot_chocolate.jpg' },
   //   { id: 'Rani_orange', name: 'Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„', price: 500, img: 'rani_orange.jpg' }
    ];

    function getRoomFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get("room");
    }

    function confirmOrder() {
      const summary = document.getElementById("order-summary");
      summary.innerHTML = "";
      let hasItems = false;

      items.forEach(item => {
        const qty = parseInt(document.getElementById(item.id).value) || 0;
        const note = document.getElementById(item.id + '-note').value.trim();
        if (qty > 0) {
          hasItems = true;
          const line = document.createElement("div");
          line.innerHTML = `<b>${item.name}</b>: ${qty} ${note ? "<br><small>Ù…Ù„Ø§Ø­Ø¸Ø©: " + note + "</small>" : ""}`;
          summary.appendChild(line);
        }
      });

      if (!hasItems) { alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙ†Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return; }
      document.getElementById("order-modal").style.display = "block";
    }

    function closeModal() { document.getElementById("order-modal").style.display = "none"; }

    async function submitConfirmedOrder() {
      closeModal();
      const btn = document.getElementById("submit-btn");
      const loader = document.getElementById("loading-spinner");
      
      btn.disabled = true;
      loader.style.display = "block";

      const roomName = getRoomFromURL();
      const time = new Date().toLocaleString('ar-EG');
      let message = `ğŸ“¦ *Ø·Ù„Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©*\n\nğŸ“ *Ø§Ù„Ù…ÙƒØ§Ù†:* ${roomName.replace(/_/g, ' ')}\n\n`;
      let orderData = { roomId: roomName, time: time, items: [] };

      items.forEach(item => {
        const qty = parseInt(document.getElementById(item.id).value) || 0;
        const note = document.getElementById(item.id + '-note').value || '';
        if (qty > 0) {
          orderData.items.push({ name: item.name, quantity: qty, note: note });
          message += `âœ… ${item.name} (${qty}) ${note ? "\nğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©: " + note : ""}\n-----------------\n`;
        }
      });

      message += `\nâ° *Ø§Ù„ÙˆÙ‚Øª:* ${time}`;

      // Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§
      const botToken = '8456418636:AAHbSTUa32suaKN5mkMOExEB_kjXHOqqZZY';
      const chatId = '-1002533366963';

      try {
        // 1. Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        const telResponse = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chat_id: chatId, text: message, parse_mode: 'Markdown' })
        });

        if (!telResponse.ok) throw new Error('ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…');

        // 2. Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Google Sheets
        await fetch('https://script.google.com/macros/s/AKfycbz9g10RUCRZO8wY9N6-H5rg6SAkFBtvAJeFx6cXZwNLgFxm5CfF_OjzrMfFXpdpjEgO/exec', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderData),
          mode: 'no-cors'
        });

        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        location.reload();
      } catch (error) {
        alert("Ø®Ø·Ø£: " + error.message);
        btn.disabled = false;
        loader.style.display = "none";
      }
    }

    window.onload = function () {
      const roomName = getRoomFromURL();
      if (validRooms.includes(roomName)) {
        document.getElementById("room-name").textContent = `Ø§Ù„Ø¬Ù‡Ø©: ${roomName.replace(/_/g, ' ')}`;
        const container = document.getElementById('items-container');
        items.forEach(item => {
  const col = document.createElement('div');
  col.className = 'col-12 col-sm-6 col-md-6 col-lg-4';
  col.innerHTML = `
    <div class="item-card">
      <img src="${item.img}" alt="${item.name}">
      <label>${item.name}</label>
      <div class="price">${item.price} Ø¯ÙŠÙ†Ø§Ø±</div>
      <div class="number">Ø§Ù„Ø¹Ø¯Ø¯</div>
      <input type="number" id="${item.id}" min="0" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯..."> 
      <textarea id="${item.id}-note" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø©..."></textarea>
    </div>`;
  container.appendChild(col);
});
      } else {
        document.body.innerHTML = "<h1>Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ© Ø£Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­</h1>";
      }
    };
  </script>
</body>
</html>