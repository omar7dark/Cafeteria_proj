<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒØ§ÙÙŠØªÙŠØ±ÙŠØ§</title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      background: #f5f5f5;
      padding: 20px;
      margin: 0;
      text-align: center;
    }

    h1 {
      color: #333;
      margin-bottom: 20px;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      justify-items: center;
    }

    .item-card {
      background: white;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 180px;
      text-align: center;
    }

    .item-card img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 6px;
    }

    .item-card label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }

    .price {
      color: #666;
      margin-bottom: 5px;
    }

    .item-card input[type="number"] {
      width: 60px;
      padding: 5px;
      font-size: 16px;
      text-align: center;
    }

    .item-card textarea {
      width: 100%;
      padding: 5px;
      font-size: 14px;
      margin-top: 10px;
      resize: vertical;
      height: 60px;
      border-radius: 6px;
    }

    button {
      margin-top: 20px;
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      cursor: pointer;
      border-radius: 10px;
    }

    button:hover {
      background-color: #45a049;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Ø·Ù„Ø¨Ø§Øª ÙƒØ§ÙÙŠØªÙŠØ±ÙŠØ§ Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠ</h1>
  <h2 id="room-name">ØºØ±ÙØ© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©</h2>

  <div class="grid-container" id="items-container">
    <!-- ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù‡Ù†Ø§ -->
  </div>

  <button id="submit-btn" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</button>

  <script>
    const validRooms = [
      "Ø§Ù„Ù†Ø§Ø¯ÙŠ_Ø§Ù„Ø¹Ù„Ù…ÙŠ",
      "Ø§Ù„ØºØ±ÙØ©_Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©",
      "Ù†Ù‚Ø§Ø¨Ø©_Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ÙŠÙ†",
      "Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª_Ø§Ù„Ù…Ø­Ù„ÙŠØ©"
    ];

    const items = [
      { id: 'water', name: 'Ù…Ø§Ø¡', price: 250, img: 'water.jpg' },
      { id: 'tea', name: 'Ø´Ø§ÙŠ', price: 500, img: 'tea.jpg' },
      { id: 'tea_walnut', name: 'Ø´Ø§ÙŠ Ø¨Ø§Ù„Ø¬ÙˆØ²', price: 1500, img: 'tea_walnut.jpg' },
      { id: 'lemon', name: 'Ø­Ø§Ù…Ø¶', price: 500, img: 'lemon.jpg' },
      { id: 'arabic_coffee', name: 'Ù‚Ù‡ÙˆØ© Ø¹Ø±Ø¨ÙŠØ©', price: 2000, img: 'arabic_coffee.jpg' },
      { id: 'turkish_coffee', name: 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠØ©', price: 2000, img: 'turkish_coffee.jpg' },
      { id: 'turkish_walnut', name: 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠØ© Ø¨Ø§Ù„Ø¬ÙˆØ²', price: 2500, img: 'turkish_walnut.jpg' },
      { id: 'espresso', name: 'Ù‚Ù‡ÙˆØ© Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ', price: 2500, img: 'espresso.jpg' },
      { id: 'chocolate_coffee', name: 'Ù‚Ù‡ÙˆØ© Ø¬ÙƒÙ„ÙŠØªÙŠØ©', price: 2000, img: 'choco_coffee.jpg' },
      { id: 'choco_walnut', name: 'Ù‚Ù‡ÙˆØ© Ø¬ÙƒÙ„ÙŠØªÙŠÙ‡ Ø¨Ø§Ù„Ø¬ÙˆØ²', price: 2500, img: 'choco_walnut.jpg' },
      { id: 'milk_walnut', name: 'Ø­Ù„ÙŠØ¨ Ø³Ø§Ø®Ù† Ø¨Ø§Ù„Ø¬ÙˆØ²', price: 1500, img: 'milk_walnut.jpg' },
      { id: 'cappuccino', name: 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ', price: 2000, img: 'cappuccino.jpg' },
      { id: 'cappuccino_walnut', name: 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ø¨Ø§Ù„Ø¬ÙˆØ²', price: 2500, img: 'cappuccino_walnut.jpg' },
      { id: 'nescafe', name: 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡', price: 2000, img: 'nescafe.jpg' },
      { id: 'nescafe_walnut', name: 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ø§Ù„Ø¬ÙˆØ²', price: 2500, img: 'nescafe_walnut.jpg' },
      { id: 'hot_nutella', name: 'Ù‡ÙˆØª Ù†ÙˆØªÙŠÙ„Ø§', price: 2000, img: 'hot_nutella.jpg' },
      { id: 'choco_milk_walnut', name: 'ÙƒØ§ÙƒØ§Ùˆ ÙˆØ­Ù„ÙŠØ¨ Ø¨Ø§Ù„Ø¬ÙˆØ²', price: 2000, img: 'choco_milk.jpg' },
      { id: 'hot_chocolate', name: 'Ù‡ÙˆØª Ø¬ÙˆÙƒÙ„ÙŠØª', price: 2500, img: 'hot_chocolate.jpg' }
    ];

    function getRoomFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get("room");
    }

    function setRoomName(roomName) {
      const roomElement = document.getElementById("room-name");
      roomElement.textContent = `ØºØ±ÙØ©: ${roomName}`;
    }

    function disablePage() {
      document.getElementById("room-name").textContent = "âŒ Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙØ¹Ù„Ø©";
      document.getElementById("items-container").classList.add("hidden");
      document.getElementById("submit-btn").disabled = true;
      document.getElementById("submit-btn").style.opacity = 0.5;
    }

    async function sendOrder() {
      const roomName = getRoomFromURL();
      const time = new Date().toLocaleString('ar-EG');

      const order = {
        roomId: roomName,
        time: time,
        items: []
      };

      let message = `ğŸ›ï¸ Ø·Ù„Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† ØºØ±ÙØ©: ${roomName}\n`;

      items.forEach(item => {
        const quantity = parseInt(document.getElementById(item.id).value) || 0;
        const note = document.getElementById(item.id + '-note').value || ''; // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
        if (quantity > 0) {
          order.items.push({
            name: item.name,
            quantity: quantity,
            price: item.price,
            subtotal: item.price * quantity,
            note: note // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ø·Ù„Ø¨
          });
          if (note) {
            message += ` ${item.name}: ${quantity} - Ù…Ù„Ø§Ø­Ø¸Ø©: ${note}\n`;
          } else {
            message += ` ${item.name}: ${quantity}\n`;
          }
        }
      });

      message += `ğŸ•’ Ø§Ù„ÙˆÙ‚Øª: ${time}`;

      const botToken = '8014365512:AAFV1nIDBPzwJwItUrZudEHIkz9cMgyJGP4';
      const chatId = '-1002533366963';
      const telegramURL = `https://api.telegram.org/bot${botToken}/sendMessage`;

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Telegram
      await fetch(telegramURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chatId, text: message })
      });

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Google Sheets
      await fetch('https://script.google.com/macros/s/AKfycbwgvyqNbbiJsePSLq3qkCLvYzPnyoa7l0uDy87f23G48vQjuc3jGW2CcumeTPRPhNpK/exec', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(order),
        mode: 'no-cors'
      });

      alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
      location.reload();
    }

    window.onload = function () {
      const roomName = getRoomFromURL();
      if (validRooms.includes(roomName)) {
        setRoomName(roomName);
        const container = document.getElementById('items-container');
        items.forEach(item => {
          const div = document.createElement('div');
          div.className = 'item-card';
          div.innerHTML = `
            <img src="images/${item.img}" alt="${item.name}">
            <label for="${item.id}">${item.name}</label>
            <div class="price">${item.price} Ø¯ÙŠÙ†Ø§Ø±</div>
            <input type="number" id="${item.id}" min="0" value="0">
            <textarea id="${item.id}-note" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø©..."></textarea>
          `;
          container.appendChild(div);
        });
      } else {
        disablePage();
      }
    };
  </script>
</body>
</html>
